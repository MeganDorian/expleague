DRAGDIS.storage={get:function(a,b){window.chrome.storage.local.get(a,function(c){b(c[a]||"")})},set:function(a,b){var c={};c[a]=b,window.chrome.storage.local.set(c),"UserActive"==a&&b.Username&&(DRAGDIS.config.Username=b.Username)}},DRAGDIS.disabledDomains={storageName:"DisabledDomains",list:[],add:function(a){var b=this;DRAGDIS.storage.get(b.storageName,function(c){var d=c?JSON.parse(c):[],e=c.indexOf(a);-1===e&&d.push(a),DRAGDIS.storage.set(b.storageName,JSON.stringify(d)),b.list=d,window.chrome.tabs.query({highlighted:!0,active:!0},function(a){for(var c=0;c<a.length;c++)b.updateTabContextMenu(a[c].id)})})},remove:function(a){var b=this;if(this.list.length>0){var c=$.inArray(a,this.list);-1!==c&&this.list.splice(c,1),DRAGDIS.storage.set(this.storageName,JSON.stringify(this.list)),window.chrome.tabs.query({highlighted:!0,active:!0},function(a){for(var c=0;c<a.length;c++)b.updateTabContextMenu(a[c].id)})}},updateTabContextMenu:function(a){var b=this;window.chrome.tabs.get(a,function(a){if(a.url){var c=DRAGDIS.getHostName(a.url);DRAGDIS.storage.get(b.storageName,function(a){var d=a?JSON.parse(a):[];b.list=d,-1!==$.inArray(c,d)?(window.chrome.contextMenus.update(DisabledDomains_Disable,{enabled:!1}),window.chrome.contextMenus.update(DisabledDomains_Enable,{enabled:!0})):(window.chrome.contextMenus.update(DisabledDomains_Disable,{enabled:!0}),window.chrome.contextMenus.update(DisabledDomains_Enable,{enabled:!1}))})}})}},DRAGDIS.injection={matches:["^http*.://.+/*"],exclude_matches:["^https://.+(bank).+","^http(s|)://dragdis.com(/#.*|)$","^http(s|)://*.dragdis.com(/#.*|)$","^http*.://(maps.google.com|www.google.com/maps).+","^http*.://www.bing.com/maps.+","^http*.://drive.google.com.+"],JS:chrome.runtime.getManifest().content_scripts[0].js,CSS:chrome.runtime.getManifest().content_scripts[0].css,inject:function(a){chrome.tabs.executeScript(a,{code:"chrome.runtime.sendMessage({ExtensionIsInjected: window.ExtensionIsInjected || false});"},function(){chrome.runtime.lastError})},isMatch:function(a){for(var b=0;b<this.exclude_matches.length;b++){var c=new RegExp(this.exclude_matches[b],"i");if(c.test(a))return!1}for(var d=0;d<DRAGDIS.disabledDomains.list.length;d++){var e=new RegExp("^http*.://(.+)?("+DRAGDIS.disabledDomains.list[d]+").+","i");if(e.test(a))return!1}for(var f=0;f<this.matches.length;f++){var g=new RegExp(this.matches[f],"i");if(g.test(a))return!0}return!1},add:function(a,b){var c=this;if(c.isMatch(b)){console.info("DO INJECTION "+a,b);for(var d=0;d<c.JS.length;d++)window.chrome.tabs.executeScript(a,{file:c.JS[d],allFrames:!1,runAt:"document_start"},function(){chrome.runtime.lastError});for(var e=0;e<c.CSS.length;e++)window.chrome.tabs.insertCSS(a,{file:c.CSS[e],allFrames:!1,runAt:"document_start"},function(){chrome.runtime.lastError});DRAGDIS.tracker.send(a)}},reInject:function(){}},chrome.tabs.onUpdated.addListener(function(a,b,c){setTimeout(DRAGDIS.disabledDomains.updateTabContextMenu(a)),0===c.url.toLowerCase().indexOf("http")&&"loading"===b.status&&DRAGDIS.injection.inject(a)}),chrome.tabs.onReplaced.addListener(function(a){window.chrome.tabs.get(a,function(b){setTimeout(DRAGDIS.disabledDomains.updateTabContextMenu(a)),0===b.url.toLowerCase().indexOf("http")&&DRAGDIS.injection.inject(a)})}),DRAGDIS.tracker={tabsUrls:[],data:[],add:function(a,b){var c=this;b>0&&chrome.tabs.get(b,function(a){c.tabsUrls[a.id]=a.url}),this.data[b]||(this.data[b]=[]),this.data[b].push(a)},send:function(a){if(this.data[a]&&this.data[a].length>0){var b=this.tabsUrls[a]||"",c=JSON.parse(JSON.stringify(this.data[a]));delete this.data[a],delete this.tabsUrls[a],DRAGDIS.api.Tracker({data:c,sourceLink:b}).then(function(a){200!==a.status})}}},chrome.tabs.onRemoved.addListener(function(a){DRAGDIS.tracker.send(a)}),chrome.windows.onRemoved.addListener(function(a){DRAGDIS.tracker.send(a)}),window.chrome.contextMenus.create({title:"Open dragdis.com",contexts:["all"],onclick:function(){window.chrome.tabs.create({url:DRAGDIS.config.domain}),new TrackEvent("Sidebar offsite","Click on context 'open dragdis.com'").send(!0)}}),window.chrome.contextMenus.create({type:"separator",contexts:["page"]});var DisabledDomains_Disable=window.chrome.contextMenus.create({title:"Disable on this page",contexts:["page"],onclick:function(a){DRAGDIS.disabledDomains.add(DRAGDIS.getHostName(a.pageUrl))}}),DisabledDomains_Enable=window.chrome.contextMenus.create({title:"Enable on this page",contexts:["page"],onclick:function(a){DRAGDIS.disabledDomains.remove(DRAGDIS.getHostName(a.pageUrl))}});window.chrome.contextMenus.create({type:"separator",contexts:["page"]}),DRAGDIS.updateDarkMode=function(a,b){chrome.contextMenus.update(a,{title:b?"Make it white":"Make it dark"})};var makeItDarkContext=window.chrome.contextMenus.create({title:"Make it dark",contexts:["all"],onclick:function(a){DRAGDIS.storage.get("dragdisDark",function(b){DRAGDIS.storage.set("dragdisDark",!b),DRAGDIS.updateDarkMode(a.menuItemId,!b)})}});DRAGDIS.storage.get("dragdisDark",function(a){DRAGDIS.updateDarkMode(makeItDarkContext,a)}),window.chrome.browserAction.onClicked.addListener(function(a){new TrackEvent("Sidebar offsite","Click on toolbar icon").send(!0),"chrome://newtab/"==a.url?window.chrome.tabs.update(a.id,{url:DRAGDIS.config.domain}):-1==a.url.indexOf("chrome://")&&DRAGDIS.sendMessage({Type:"SIDEBAR_SHOW"})}),window.chrome.omnibox.onInputEntered.addListener(function(a){window.chrome.tabs.create({url:DRAGDIS.config.domain+"#/search/"+a})}),DRAGDIS.browserDetails=function(){var d,e,f,g,a=navigator.userAgent,b=navigator.appName,c=""+parseFloat(navigator.appVersion);-1!==(f=a.indexOf("Opera"))?(b="Opera",c=a.substring(f+6),-1!==(f=a.indexOf("Version"))&&(c=a.substring(f+8))):-1!==(f=a.indexOf("MSIE"))?(b="Microsoft Internet Explorer",c=a.substring(f+5)):-1!==(f=a.indexOf("Chrome"))?(b="Chrome",c=a.substring(f+7)):-1!==(f=a.indexOf("Safari"))?(b="Safari",c=a.substring(f+7),-1!==(f=a.indexOf("Version"))&&(c=a.substring(f+8))):-1!==(f=a.indexOf("Firefox"))?(b="Firefox",c=a.substring(f+8)):(e=a.lastIndexOf(" ")+1)<(f=a.lastIndexOf("/"))&&(b=a.substring(e,f),c=a.substring(f+1),b.toLowerCase()==b.toUpperCase()&&(b=navigator.appName)),-1!==(g=c.indexOf(";"))&&(c=c.substring(0,g)),-1!==(g=c.indexOf(" "))&&(c=c.substring(0,g)),d=parseInt(""+c,10),isNaN(d)&&(c=""+parseFloat(navigator.appVersion),d=parseInt(navigator.appVersion,10));var h="Unknown OS";-1!=navigator.appVersion.indexOf("Win")&&(h="Windows"),-1!=navigator.appVersion.indexOf("Mac")&&(h="Mac"),-1!=navigator.appVersion.indexOf("X11")&&(h="UNIX"),-1!=navigator.appVersion.indexOf("Linux")&&(h="Linux"),DRAGDIS.config.browser={OS:h,name:b,version:d,versionFull:c}},DRAGDIS.browserDetails(),DRAGDIS.isCanvasSupported=function(){var a=document.createElement("canvas");return!(!a.getContext||!a.getContext("2d"))},DRAGDIS.config.CanvasEnabled=DRAGDIS.isCanvasSupported(),DRAGDIS.getHostName=function(a){var b=a.match(/:\/\/(www[0-9]?\.)?(.[^/:]+)/i);return null!==b&&b.length>2&&"string"==typeof b[2]&&b[2].length>0?b[2]:null},DRAGDIS.bookmarks={get:function(a){chrome.bookmarks.getTree(function(b){var c=JSON.stringify(b);a(c)})}},DRAGDIS.templates={list:{},init:function(){var a=["views/root.html","views/login.html","views/sidebar.html","views/empty.html","views/error.html","views/sidebar.folder_0.html","views/sidebar.folder_1.html","views/actionsBlock.html","views/panel_folder.html","views/panel_item.html","views/panel_newFolder.html","views/dragUpload.html"],b=[];$.each(a,function(a,c){var d=$.get(chrome.extension.getURL(c),function(a){DRAGDIS.templates.list[c]=a});b.push(d)}),$.when.apply($,b).then(function(){DRAGDIS.storage.set("templates",JSON.stringify(DRAGDIS.templates.list))})}},DRAGDIS.templates.init();