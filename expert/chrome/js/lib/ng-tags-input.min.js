!function(){"use strict";function b(){var a={};return{on:function(b,c){return b.split(" ").forEach(function(b){a[b]||(a[b]=[]),a[b].push(c)}),this},trigger:function(b,c){return angular.forEach(a[b],function(a){a.call(null,c)}),this}}}function c(a,b){return a=a||[],a.length>0&&!angular.isObject(a[0])&&a.forEach(function(c,d){a[d]={},a[d][b]=c}),a}function d(a,b,c){for(var d=null,e=0;e<a.length;e++)if(a[e][c].toLowerCase()===b[c].toLowerCase()){d=a[e];break}return d}function e(a,b,c){var d=b.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1");return a.replace(new RegExp(d,"gi"),c)}var a={backspace:8,tab:9,enter:13,escape:27,space:32,up:38,down:40,comma:188},f=angular.module("ngTagsInput",[]);f.directive("tagsInput",["$timeout","$document","tagsInputConfig","$sce",function(e,f,g,h){function i(a,b){var e,f,g,c={};return e=function(b){return b[a.displayProperty]},f=function(b,c){b[a.displayProperty]=c},g=function(b){var f=e(b);return f.length>=a.minLength&&f.length<=(a.maxLength||f.length)&&a.allowedTagsPattern.test(f)&&!d(c.items,b,a.displayProperty)},c.items=[],c.addText=function(a){var b={};return f(b,a),c.add(b)},c.add=function(d){var h=e(d).trim();return a.replaceSpacesWithDashes&&(h=h.replace(/\s/g,"-")),f(d,h),g(d)?(c.items.push(d),b.trigger("tag-added",{$tag:d})):b.trigger("invalid-tag",{$tag:d}),d},c.remove=function(a){var d=c.items.splice(a,1)[0];return b.trigger("tag-removed",{$tag:d}),d},c.removeLast=function(){var b,d=c.items.length-1;return a.enableEditingLastTag||c.selected?(c.selected=null,b=c.remove(d)):c.selected||(c.selected=c.items[d]),b},c}return{restrict:"E",require:"ngModel",scope:{tags:"=ngModel",onTagAdded:"&",onTagRemoved:"&"},replace:!1,transclude:!0,templateUrl:h.trustAsResourceUrl("ngTagsInput/tags-input.html"),controller:["$scope","$attrs","$element",function(a,c,d){g.load("tagsInput",a,c,{placeholder:[String,"Add a tag"],tabindex:[Number],removeTagSymbol:[String,String.fromCharCode(215)],replaceSpacesWithDashes:[Boolean,!0],minLength:[Number,2],maxLength:[Number],addOnEnter:[Boolean,!0],addOnSpace:[Boolean,!1],addOnComma:[Boolean,!0],addOnBlur:[Boolean,!0],allowedTagsPattern:[RegExp,/.+/],enableEditingLastTag:[Boolean,!1],minTags:[Number],maxTags:[Number],displayProperty:[String,"text"],allowLeftoverText:[Boolean,!1],addFromAutocompleteOnly:[Boolean,!1]}),a.events=new b,a.tagList=new i(a.options,a.events),this.registerAutocomplete=function(){var b=d.find("input");return b.on("keydown",function(b){a.events.trigger("input-keydown",b)}),{addTag:function(b){return a.tagList.add(b)},focusInput:function(){b[0].focus()},getTags:function(){return a.tags},getOptions:function(){return a.options},on:function(b,c){return a.events.on(b,c),this}}}}],link:function(b,d,g,h){var i=[a.enter,a.comma,a.space,a.backspace],j=b.tagList,k=b.events,l=b.options,m=d.find("input");k.on("tag-added",b.onTagAdded).on("tag-removed",b.onTagRemoved).on("tag-added",function(){b.newTag.text=""}).on("tag-added tag-removed",function(){h.$setViewValue(b.tags)}).on("invalid-tag",function(){b.newTag.invalid=!0}).on("input-change",function(){j.selected=null,b.newTag.invalid=null}).on("input-focus",function(){h.$setValidity("leftoverText",!0)}).on("input-blur",function(){l.addFromAutocompleteOnly||(l.addOnBlur&&j.addText(b.newTag.text),h.$setValidity("leftoverText",l.allowLeftoverText?!0:!b.newTag.text))}),b.newTag={text:"",invalid:null},b.getDisplayText=function(a){return a[l.displayProperty].trim()},b.track=function(a){return a[l.displayProperty]},b.newTagChange=function(){k.trigger("input-change",b.newTag.text)},b.$watch("tags",function(a){b.tags=c(a,l.displayProperty),j.items=b.tags}),b.$watch("tags.length",function(a){h.$setValidity("maxTags",angular.isUndefined(l.maxTags)||a<=l.maxTags),h.$setValidity("minTags",angular.isUndefined(l.minTags)||a>=l.minTags)}),m.on("keydown",function(c){if(!c.isImmediatePropagationStopped||!c.isImmediatePropagationStopped()){var g,h,d=c.keyCode,e=c.shiftKey||c.altKey||c.ctrlKey||c.metaKey,f={};if(!e&&-1!==i.indexOf(d))if(f[a.enter]=l.addOnEnter,f[a.comma]=l.addOnComma,f[a.space]=l.addOnSpace,g=!l.addFromAutocompleteOnly&&f[d],h=!g&&d===a.backspace&&0===b.newTag.text.length,g)j.addText(b.newTag.text),b.$apply(),c.preventDefault();else if(h){var k=j.removeLast();k&&l.enableEditingLastTag&&(b.newTag.text=k[l.displayProperty]),b.$apply(),c.preventDefault()}}}).on("focus",function(){b.hasFocus||(b.hasFocus=!0,k.trigger("input-focus"),b.$apply())}).on("blur",function(){e(function(){var a=f.prop("activeElement"),c=a===m[0],e=d[0].contains(a);(c||!e)&&(b.hasFocus=!1,k.trigger("input-blur"))})}),d.find("div").on("click",function(){m[0].focus()})}}}]),f.directive("autoComplete",["$document","$timeout","$sce","tagsInputConfig",function(b,f,g,h){function i(a,b){var g,h,i,e={};return h=function(a,c){return a.filter(function(a){return!d(c,a,b.tagsInput.displayProperty)})},e.reset=function(){i=null,e.items=[],e.visible=!1,e.index=-1,e.selected=null,e.query=null,f.cancel(g)},e.show=function(){e.selected=null,e.visible=!0},e.load=function(d,j){return d.length<b.minLength?(e.reset(),void 0):(f.cancel(g),g=f(function(){e.query=d;var f=a({$query:d});i=f,f.then(function(a){f===i&&(a=c(a.data||a,b.tagsInput.displayProperty),a=h(a,j),e.items=a.slice(0,b.maxResultsToShow),e.items.length>0?e.show():e.reset())})},b.debounceDelay,!1),void 0)},e.selectNext=function(){e.select(++e.index)},e.selectPrior=function(){e.select(--e.index)},e.select=function(a){0>a?a=e.items.length-1:a>=e.items.length&&(a=0),e.index=a,e.selected=e.items[a]},e.reset(),e}function j(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}return{restrict:"E",require:"^tagsInput",scope:{source:"&"},templateUrl:"ngTagsInput/auto-complete.html",link:function(c,d,f,k){var m,n,o,p,q,l=[a.enter,a.tab,a.escape,a.up,a.down];h.load("autoComplete",c,f,{debounceDelay:[Number,100],minLength:[Number,3],highlightMatchedText:[Boolean,!0],maxResultsToShow:[Number,10]}),o=c.options,n=k.registerAutocomplete(),o.tagsInput=n.getOptions(),m=new i(c.source,o),p=function(a){return a[o.tagsInput.displayProperty]},c.suggestionList=m,c.addSuggestion=function(){var a=!1;return m.selected&&(n.addTag(m.selected),m.reset(),n.focusInput(),a=!0),a},c.highlight=function(a){var b=p(a);return b=j(b),o.highlightMatchedText&&(b=e(b,j(m.query),"<em>$&</em>")),g.trustAsHtml(b)},c.track=function(a){return p(a)},n.on("tag-added invalid-tag",function(){m.reset()}).on("input-change",function(a){a?m.load(a,n.getTags()):m.reset()}).on("input-keydown",function(b){var d,e;if(-1!==l.indexOf(b.keyCode)){var f=!1;b.stopImmediatePropagation=function(){f=!0,b.stopPropagation()},b.isImmediatePropagationStopped=function(){return f},m.visible&&(d=b.keyCode,e=!1,d===a.down?(m.selectNext(),e=!0):d===a.up?(m.selectPrior(),e=!0):d===a.escape?(m.reset(),e=!0):(d===a.enter||d===a.tab)&&(e=c.addSuggestion()),e&&(b.preventDefault(),b.stopImmediatePropagation(),c.$apply()))}}).on("input-blur",function(){m.reset()}),q=function(){m.visible&&(m.reset(),c.$apply())},b.on("click",q),c.$on("$destroy",function(){b.off("click",q)})}}}]),f.directive("tiTranscludeAppend",function(){return function(a,b,c,d,e){e(function(a){b.append(a)})}}),f.directive("tiAutosize",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){var f,g,e=3;f=angular.element('<span class="input"></span>'),f.css("display","none").css("visibility","hidden").css("width","auto").css("white-space","pre"),b.parent().append(f),g=function(a){var g,d=a;return angular.isString(d)&&0===d.length&&(d=c.placeholder),d&&(f.text(d),f.css("display",""),g=f.prop("offsetWidth"),f.css("display","none")),b.css("width",g?g+e+"px":""),a},d.$parsers.unshift(g),d.$formatters.unshift(g),c.$observe("placeholder",function(a){d.$modelValue||g(a)})}}}),f.provider("tagsInputConfig",function(){var a={},b={};this.setDefaults=function(b,c){return a[b]=c,this},this.setActiveInterpolation=function(a,c){return b[a]=c,this},this.$get=["$interpolate",function(c){var d={};return d[String]=function(a){return a},d[Number]=function(a){return parseInt(a,10)},d[Boolean]=function(a){return"true"===a.toLowerCase()},d[RegExp]=function(a){return new RegExp(a)},{load:function(e,f,g,h){f.options={},angular.forEach(h,function(h,i){var j,k,l,m,n;j=h[0],k=h[1],l=d[j],m=function(){var b=a[e]&&a[e][i];return angular.isDefined(b)?b:k},n=function(a){f.options[i]=a?l(a):m()},b[e]&&b[e][i]?g.$observe(i,function(a){n(a)}):n(g[i]&&c(g[i])(f.$parent))})}}}]}),f.run(["$templateCache",function(a){a.put("ngTagsInput/tags-input.html",'<div class="host" tabindex="-1" ti-transclude-append=""><div class="tags" ng-class="{focused: hasFocus}"><ul class="tag-list"><li class="tag-item" ng-repeat="tag in tagList.items track by track(tag)" ng-class="{ selected: tag == tagList.selected }"><span>{{getDisplayText(tag)}}</span> <a class="remove-button" ng-click="tagList.remove($index)">{{options.removeTagSymbol}}</a></li></ul><input class="input" placeholder="{{options.placeholder}}" tabindex="{{options.tabindex}}" ng-model="newTag.text" ng-change="newTagChange()" ng-trim="false" ng-class="{\'invalid-tag\': newTag.invalid}" ti-autosize=""></div></div>'),a.put("ngTagsInput/auto-complete.html",'<div class="autocomplete" ng-show="suggestionList.visible"><ul class="suggestion-list"><li class="suggestion-item" ng-repeat="item in suggestionList.items track by track(item)" ng-class="{selected: item == suggestionList.selected}" ng-click="addSuggestion()" ng-mouseenter="suggestionList.select($index)" ng-bind-html="highlight(item)"></li></ul></div>')}])}();