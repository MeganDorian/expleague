"use strict";!function(a){a.expr[":"].regex=function(a,b,c){var d=c[3].split(","),e=/^(data|css):/,f={method:d[0].match(e)?d[0].split(":")[0]:"attr",property:d.shift().replace(e,"")},g="ig",h=new RegExp(d.join("").replace(/^\s+|\s+$/g,""),g);return h.test(jQuery(a)[f.method](f.property))},a.fn.classes=function(){var b=[];return a.each(this,function(a,c){var d=c.className.split(/\s+/);for(var e in d){var f=d[e];f&&b.indexOf(-1===f)&&b.push(f)}}),b},a.fn.nodesArray=function(){var b=[];return a(this).find("div, span, p, table, td, tr, li, a").each(function(){var c=a(this).get(0).tagName.toLowerCase();b.push(c);var d=a(this).classes();d.length&&a.each(d,function(a,d){b.push(c+"."+d)}),a(this).attr("id")&&b.push(c+"#"+a(this).attr("id"))}),b},a.fn.knuggetScrapping=function(b){function i(a){for(var b=new Array,c=0;c<a.length;c++)a[c]&&a[c].length>3&&-1===a[c].indexOf("<!--")&&-1===a[c].indexOf("-->")&&b.push(a[c]);return b}function j(a){return a.replace(/(\r\n|\n|\r)/gm," ").replace(/[&\/\\#,+=\u2014\u2022()$~%.\-!'"\u201e\u201c:;_*?<>|{}]/g," ").trim().replace(/\s+/g," ").toLowerCase()}function k(a){return a.filter(function(b,c){return a.indexOf(b)==c})}function l(b){var c,e;return b.parents().each(function(){var b=a(this),e=b.nodesArray();return b.addClass(d),b.parent().children().not("."+d).each(function(){var d=a(this).nodesArray(),f=[],g=e.slice(0);a.grep(d,function(b){-1!==a.inArray(b,g)&&(f.push(b),g.splice(a.inArray(b,g),1))});var h=100*(f.length/e.length);return h>70?(c=b,!1):void 0}),c?!1:void 0}),void 0==c&&b.parents().each(function(b){var c=a(this),f=c.get(0).tagName.toLowerCase(),g=i(c.classes());if(g.length>0)for(b=0;b<g.length;b++)if(c.parent().children(f+"."+g[b]).not("."+d).length>0)return e=c,!1}),a("."+d).removeClass(d),c||e}function m(b){var c;return b.parents().each(function(){return a(this).children("h1").length||a(this).children(":regex(class,article), :regex(class,content)").length?(c=a(this).parent(),!1):void 0}),c}function n(b){var c={};a.each(b,function(a,b){c[b]?c[b]++:c[b]=1});var d=[];for(var e in c)d.push({key:e,value:c[e]});d.sort(function(a,b){return b.value-a.value});for(var f=[],g=0;g<d.length;g++)f.push(d[g].key);return f}function o(b){var c=b.clone();a(c).find("script,noscript,style,iframe,input,:regex(href,javascript),:regex(class,relate),:regex(class,date),:regex(class,time):not(:regex(class,timeline)),:regex(class,timestamp),:regex(class,loader),:regex(class,loading),:regex(class,count):not(':regex(class,account)'),:regex(class,vote),:regex(class,signature),:regex(class,author),:regex(class,read),:regex(class,more),:regex(class,button),:regex(class,links),:regex(class,bar),:regex(class,thumb),:regex(id,thumb),:regex(class,comment),:regex(class,hidden),:regex(class,hide),:regex(css:display, ^none$),:regex(class,share-button),:regex(id,share_button),footer,:regex(class,translate),:regex(class,rg_meta),:regex(class,source),:regex(class,bottom),:regex(class,rg_bb_i_meta),:regex(class,footer),:regex(id,footer),footer,*[class*='uiStreamFooter'],textarea").not(":regex(class,article),:regex(class,collapse)").remove(),c.find("*").each(function(){a(this).after(" ").before(" ")});var d=c.text()+" "+window.location.host.replace("www.","")+" "+document.title;d=j(d),d=d.split(" ");for(var f=["title","description","keywords","og:site_name","og:type","og:description","twitter:title","title:description"],g=document.getElementsByTagName("meta"),h=0,l=g.length;l>h;h++){var m=void 0!=g[h].name&&""!=g[h].name?g[h].name.toLowerCase():null,o=void 0!=g[h].property&&""!=g[h].property?g[h].property.toLowerCase():null;if(m=m||o,a.inArray(m,f)>-1){var p=j(g[h].content),q=p.split(" ");d=d.concat(q)}}var r=i(d);return r=r.length>e?n(r):k(r),r=r.slice(0,e).join(" "),a(c).remove(),r}function p(){a("."+c).removeClass(c),a("."+d).removeClass(d)}if("destroy"===b)return p(),!0;var c="knuggetCatched",d="knugget_knugget_knugget",e=200,f=a(this),g=l(f);void 0==g&&(g=m(f));var h="";return void 0!=g&&(g.addClass(c),h=o(g)),h},a.fn.knuggetCollection=function(b){function f(a){if(0==a.indexOf("http://")||0==a.indexOf("https://"));else if(0==a.indexOf("//"))a=location.protocol+a;else if(0==a.indexOf("/")){var b=window.location.protocol+"//"+window.location.host;a=b.substring(0,location.href.lastIndexOf("/"))+a}else a=location.href.substring(0,location.href.lastIndexOf("/"))+"/"+a;return a}function g(a){var b=new Image;b.src=a;var c={width:b.width,height:b.height};return c}function h(a,b){b=(((b||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");var c=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,d=/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi;return a.replace(d,"").replace(c,function(a,c){return b.indexOf("<"+c.toLowerCase()+">")>-1?a:""})}function i(b,c){return c?a.grep(b,function(a){return a=a.length?a:!1}):a.grep(b,function(a){return a})}function j(){if(c.is("#"+KNUGGET_EVENTS.selectors.VideoIcon)||c.find("#"+KNUGGET_EVENTS.selectors.VideoIcon).length)c.is("#"+KNUGGET_EVENTS.selectors.VideoIcon)||(c=c.find("#"+KNUGGET_EVENTS.selectors.VideoIcon+":first")),d.Type="video",d.Href=c.attr("data-src");else if(c.is("img"))d.Type="picture";else if(c.is("a")){var a=c.clone();if(a.find(":hidden").not("img").remove(),1==a.children().length&&1==a.find("img").length)d.Type="apicture";else{var b={jpg:!0,jpeg:!0,png:!0,gif:!0},e=c.css("background-image"),f=/\url|\(|\"|\"|\'|\)/g;if(e=e.replace(f,"").split("?"),e=e[0],b[e.substr(e.lastIndexOf(".")+1)]){var h=g(e);h.width>1&&h.height>1?(d.Type="apicturebg",d.Src=e):d.Type="link"}else d.Type="link"}}else"address_bar"==d.Type||(d.Type="text")}function k(){var b={fb:/^(http|https):\/\/www.facebook.com/,ffffound:/^(http|https):\/\/ffffound.com/,tumblr:/^(http|https):\/\/www.tumblr.com/,tumblrin:/^.tumblr.com/,pinterest:/^(http|https):\/\/pinterest.com/,flickr:/^(http|https):\/\/www.flickr.com/,twitter:/^(http|https):\/\/twitter.com/,google:/^(http|https):\/\/www.google./,youtube:/^(http|https):\/\/www.youtube.com/,vimeo:/^(http|https):\/\/vimeo.com/,ninegag:/^(http|https):\/\/9gag.com/,feedly:/^(http|https):\/\/feedly.com/},c="";a.each(b,function(a,b){return c=b.test(window.location.href)?a:"d","d"!=c?!1:void 0}),d.Sitepage=c}var c=this,d=KNUGGET.Drag.Data,e={Drag_fb_text:function(){this.Drag_d_text(),this.Get_fb_referer()},Drag_fb_picture:function(){if(c.hasClass("shareMediaPhoto")){var a=c.css("background-image");a=/^url\((['"]?)(.*)\1\)$/.exec(a),a=a?a[2]:"",d.Image=a}else d.Image=c.attr("src");if(c.parent().hasClass("uiVideoThumb")){d.Type="video";var b=c.nearest("a.shareText");d.Href=b.attr("href"),d.Title=b.text()}this.Get_fb_referer()},Drag_fb_apicture:function(){var a=c.find("img");d.Image=a.attr("src"),d.Referer=c.attr("href"),this.Get_fb_referer()},Drag_fb_link:function(){var a=c.children("div").length,b=c.find("img").length;1==b&&a?(d.Type="picture",c=c.find("img:first"),this.Drag_fb_picture()):(d.Href=f(c.attr("href")),d.Title=c.text()),this.Get_fb_referer()},Drag_fb_video:function(){this.Drag_d_video(),this.Get_fb_referer()},Get_fb_referer:function(){var a=c.nearest("a._5pcq");a.length&&(d.Referer=f(a.attr("href")))},Drag_ffffound_picture:function(){(c.parents(".related_to_item_xs").length||c.parents(".related_to_item").length||c.parents(".more_images_item").length)&&(d.Image=c.attr("src"))},Drag_ffffound_apicture:function(){c=c.find("img"),this.Drag_ffffound_picture(),d.Referer=c.attr("href")},Drag_flickr_picture:function(){var a;if(c.hasClass("pc_img")&&c.parents(".photo-display-item").length){a=c.parent().attr("href").split("/");var b=a[4],e=a[5];d.Src_location="http://www.flickr.com/photos/"+b+"/"+e+"/sizes/o/in/photostream"}else c.hasClass("nextprev_thumb")&&(a=c.parent().attr("href").split("/"),d.ownerID=a[2],d.photoID=a[3])},Drag_google_apicture:function(){c=c.find("img:first"),d.Referer=c.attr("href"),this.Drag_google_picture()},Drag_google_picture:function(){if(c.hasClass("rg_i")&&c.parent().attr("href")&&-1!=c.parent().attr("href").indexOf("imgurl=")){var b=c.parent().attr("href"),e=KNUGGET.urlParam("imgurl",b);d.Image=e,d.Referer=KNUGGET.urlParam("imgrefurl",b);var f=a.parseJSON(c.nearest(".rg_meta").text());null!=f.pt&&(d.Keywords=f.pt),d.Keywords=d.Keywords+" "+document.title}else if("irc_mi"==c.attr("id"))d.Referer=c.nearest(".irc_vpl").attr("href");else if(c.attr("class")&&-1!=c.attr("class").indexOf("vidthumb")){d.Type="video";var g=c.nearest("h3 a");d.Referer=g.attr("href")}},Drag_pinterest_picture:function(){d.Image=c.attr("src")},Drag_tumblr_picture:function(){c.hasClass("image")||c.parent().hasClass("photoset_photo")&&(d.Image=c.parent().attr("href")),this.Get_tumblr_referer()},Drag_tumblr_text:function(){this.Drag_d_text(),this.Get_tumblr_referer()},Get_tumblr_link:function(){if(c.hasClass("click_glass")){var a=c.parents(".post_content").find(".photo_stage_img");if(a.length&&a.css("background-image").length){var b=a.css("background-image");b=/^url\((['"]?)(.*)\1\)$/.exec(b),b=b?b[2]:"",d.Image=b,d.Type="picture"}else d.Href=f(c.attr("href"));d.Keywords=c.find(".post_tags").text()}this.Get_tumblr_referer()},Get_tumblr_referer:function(){var a=c.nearest("a.post_permalink");a.length||(a=c.nearest("a.tumblelog_info"),a.length||(a=c.nearest(".reblog_source .post_info_link"),a.length||(a=c.nearest(".post_info_link")))),a.length&&(d.Referer=a.attr("href"))},Drag_twitter_picture:function(){d.Image=c.attr("src"),-1!=d.Image.indexOf("/profile_images/")&&(d.Image=d.Image)},Drag_youtube_picture:function(){c.parents("a[href*='/watch?v=']").length&&(d.Type="video",d.Provider="youtube",d.Href=f(c.attr("src")))},Drag_vimeo_picture:function(){c.parents("li[id^='clip_']").length&&(d.Type="video",d.Provider="vimeo",d.Href="http://vimeo.com"+c.parent("a").attr("href"))},Drag_ninegag_apicture:function(){var a=c.find(".badge-animated-container-animated").attr("data-image");d.Image=a?a:c.find("img").attr("src"),d.Href=c.attr("href"),d.Title=c.parents("article").find("h2").text()},Drag_ninegag_link:function(){var a=c.find(".badge-animated-container-animated"),b=a.find("img").attr("src");b&&(d.Type="picture",d.Image=b,d.Href=c.attr("href"),d.Title=c.parents("article").find("h2").text());var e=a.attr("data-image");e&&e.length&&-1!==e.indexOf(".gif")&&(d.Type="picture",d.Image=e,d.Href=c.attr("href"),d.Title=c.parents("article").find("h2").text())},Drag_feedly_picture:function(){this.Get_feedly_referer()},Drag_feedly_address_bar:function(){var b=a(".inlineFrame");if(b.length&&b.is(":visible")){var c=b.find("a.entryTitle");d.Title=c.length?c.text():"",d.Href=c.length?c.attr("href"):""}this.Drag_d_address_bar()},Get_feedly_referer:function(){var a=c.nearest(".title");a.length&&(d.Referer=a.attr("href"))},Drag_d_picture:function(){var a=c.attr("src");0===a.indexOf("data:image/")?d.Base64Image=a:-1!==a.indexOf("data:image/")?(a=a.replace(/(\r\n|\n|\r)/gm,"").replace(/ /g,""),0===a.indexOf("data:image/")?d.Base64Image=a:d.Image=a):d.Image=f(c.attr("src"))},Drag_d_apicture:function(){c=c.find("img:first"),this.Drag_d_picture()},Drag_d_link:function(){d.Href=d.Href?d.Href:f(c.attr("href")),d.Title=d.Title?d.Title:c.text(),d.Referer=d.Referer?d.Referer:window.location.href,this.Drag_d_apicturebg()},Drag_d_apicturebg:function(){var a=[];a[0]=c.attr("title"),a[1]=c.text(),a=i(a),d.Keywords=a.join(" "),d.Type="link",d.Referer||(d.Referer=f(c.attr("href")),d.Href=f(c.attr("href")))},Drag_d_text:function(){var c,e,f,b="",g=KNUGGET.Drag.Context;if("undefined"!=typeof g.getSelection){if(c=g.getSelection(),c.rangeCount){e=document.createElement("div");var i;for(f=0,i=c.rangeCount;i>f;f++)e.appendChild(c.getRangeAt(f).cloneContents());b=e.innerHTML}}else"undefined"!=typeof document.selection&&"Text"==document.selection.type&&(b=document.selection.createRange().htmlText);var j=a("<div>").html(b);j.find("script,noscript").remove(),j.find("font").each(function(){a(this).replaceWith("<div>"+a(this).html()+"</div>")}),j.html(a.trim(j.html())),j.html(j.html().replace(/(<br\s*\/?>){2,}/gi,"<br>")),j.find("*").filter(function(){var b=3==this.nodeType&&!/\S/.test(this.nodeValue),c=""==a.trim(a(this).html());return b||c}).remove(),b=j.html();var k=h(b,"");d.Keywords=k,d.Text=b},Drag_d_video:function(){d.Provider=c.attr("data-provider")},Drag_d_address_bar:function(){d.Type="link",d.MakeSnapshot=!0,d.Href=d.Href?d.Href:window.location.href},Drag_default:function(){if(!d.Image&&c.attr("src")&&"video"!=d.Type){var a=c.attr("src");0===a.indexOf("data:image/")?d.Base64Image=a:d.Image=f(c.attr("src"))}!d.Keywords&&c.attr("alt")?d.Keywords=c.attr("alt"):d.Keywords||(d.Keywords=""),d.Title||(d.Title=document.title),d.Referer||(d.Referer=window.location.href),"link"!=d.Type||d.Href||(d.Href=f(c.attr("href")||window.location.href));var b=1;"youtube"===d.Sitepage&&"youtube"===d.Provider&&(b=0),b&&(d.Keywords=c.knuggetScrapping(),d.Keywords.length>1e3&&(d.Keywords=d.Keywords.substring(0,1e3)),c.knuggetScrapping("destroy"))}};if(d=a.extend({},KNUGGET.DragDATA,d),j(),k(),""!=d.Type&&""!=d.Sitepage){var l="Drag_"+d.Sitepage+"_"+d.Type,m=!1;"function"==typeof e[l]&&(e[""+l](),m=!0),l="Drag_d_"+d.Type,m||"function"!=typeof e[l]||e[""+l]()}e.Drag_default(),b(d)},a.fn.videoDragSquare=function(b){function d(b,c,d){var i,e=30,f=0,g=0,h="",j=!1;if(!b&&d)b=d;else if(!b)return!1;if(a("#"+KNUGGET_EVENTS.selectors.VideoIcon).remove(),"www.youtube.com"===window.location.host){var k=a("#"+KNUGGET_EVENTS.selectors.VideoIcon).attr("data-src");k&&k.length&&(k=k.replace("http://www.youtube.com/watch?v=","").replace("https://www.youtube.com/watch?v=","")),j=1}if(b.addClass(KNUGGET_EVENTS.selectors.VideoBlock),f=b.offset().top,j){var l=Math.abs(parseInt(b.css("top")));l&&(f+=l),g=d?d.offset().left:b.offset().left}else g=b.offset().left;switch(f+=e,c){case"youtube":if("www.youtube.com"===window.location.host){var m=a("meta[itemprop=videoId]");m&&m.attr("content").length&&(h="https://www.youtube.com/watch?v="+m.attr("content"))}""===h&&(b.is("embed")?(b.attr("flashvars")&&-1!=b.attr("flashvars").indexOf("&vid=")?i=KNUGGET.urlParam("vid",b.attr("flashvars")):b.attr("flashvars")&&-1!=b.attr("flashvars").indexOf("&video_id=")?i=KNUGGET.urlParam("video_id",b.attr("flashvars")):b.attr("src")&&(h=b.attr("src")),i&&(h="https://www.youtube.com/watch?v="+i)):b.is("video")?(i=b.attr("data-youtube-id"),i&&(h="https://www.youtube.com/watch?v="+i)):b.attr("src").indexOf("https://attachment.fbsbx.com/external_iframe.php")>-1&&b.parents(".knugget_video_player")?h=b.parents(".knugget_video_player").attr("data-knuggetVideoHref"):(h=b.attr("src")||b.attr("data"),-1!==h.indexOf("list=")&&(h=""),h.indexOf("?")>0&&(h=h.substring(0,h.indexOf("?")))));break;case"vimeo":if(b.is("object")){var n=b.find("param[name=flashvars]");n&&-1!=n.val().indexOf("&clip_id=")&&(i=KNUGGET.urlParam("clip_id",n.val())),i&&(h="http://www.vimeo.com/"+i)}else if(b.hasClass("vimeo_holder")&&!b.find("object").length)if(b.find("video").length)h=b.find("video[src*='//player.vimeo.com/play']").attr("src");else{var o=b.find("div[id^='player_']");o=o.attr("id"),o&&(o=o.split("_"),o=o[1],o&&(h="http://www.vimeo.com/"+o))}else h=b.hasClass("player")&&b.find("video,object").length&&b.attr("data-fallback-url")?b.attr("data-fallback-url"):b.attr("src").indexOf("https://attachment.fbsbx.com/external_iframe.php")>-1&&b.parents(".knugget_video_player")?b.parents(".knugget_video_player").attr("data-knuggetVideoHref"):b.attr("src")}if(h){var p=document.createElement("img");p.id=KNUGGET_EVENTS.selectors.VideoIcon,p.setAttribute("data-provider",c),p.setAttribute("data-src",h),p.setAttribute("draggable",!0),p.setAttribute("src",KNUGGET.extensionFileUrl("images/drag_icon.gif")),p.setAttribute("style","width:30px !important;height:30px !important;"),a(p).appendTo("body").css({top:f,left:g})}return!0}switch(b.data.provider){case"youtube":if("fullscreen"!==a("body").attr("data-player-size")){var c=a(b.target).hasClass("html5-video-container")?a(b.target):a(b.target).closest(".html5-video-container");c.length?d(c.find("video").eq(0)||c.find("embed").eq(0),"youtube",c):d(a(this),"youtube")}break;case"vimeo":d(a(this),"vimeo")}},a.fn.fixFlash=function(){var b;a("embed[src*='://s.ytimg.com/yts/swfbin/watch']").each(function(){var d,c=a(this)[0];c.outerHTML?(b=c.outerHTML,d=b.match(/wmode\s*=\s*('|")[a-zA-Z]+('|")/i)?b.replace(/wmode\s*=\s*('|")window('|")/i,"wmode='transparent'"):b.replace(/<embed\s/i,"<embed wmode='transparent' "),c.insertAdjacentHTML("afterEnd",d),c.parentNode.removeChild(c)):(d=c.cloneNode(!0),d.getAttribute("wmode")&&"window"!=d.getAttribute("wmode").toLowerCase()||d.setAttribute("wmode","transparent"),c.parentNode.replaceChild(d,c))}),a("object[data*='://www.youtube.com/v/'], object[data*='vimeocdn.com/p/flash']").each(function(){var d,c=a(this)[0];if(c.outerHTML){b=c.outerHTML,d=b.match(/<param\s+name\s*=\s*('|")wmode('|")\s+value\s*=\s*('|")[a-zA-Z]+('|")\s*\/?\>/i)?b.replace(/<param\s+name\s*=\s*('|")wmode('|")\s+value\s*=\s*('|")window('|")\s*\/?\>/i,"<param name='wmode' value='transparent' />"):b.replace(/<\/object\>/i,"<param name='wmode' value='transparent' />\n</object>");for(var e=c.childNodes,f=0;f<e.length;f++)try{if(null!=e[f]){var g=e[f].getAttribute("name");null!=g&&g.match(/flashvars/i)&&(d=d.replace(/<param\s+name\s*=\s*('|")flashvars('|")\s+value\s*=\s*('|")[^'"]*('|")\s*\/?\>/i,"<param name='flashvars' value='"+e[f].getAttribute("value")+"' />"))}}catch(h){}c.insertAdjacentHTML("beforeBegin",d),c.parentNode.removeChild(c)}})}}(jQuery);